<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Zexho - 永远保持孩子般的好奇</title><meta name="author" content="邹志浩,zouzhihao994@gmail.com"><meta name="copyright" content="邹志浩"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="芝兰生于幽谷,不因无人而不芳">
<meta property="og:type" content="website">
<meta property="og:title" content="Zexho">
<meta property="og:url" content="https://zexho994.github.io/index.html">
<meta property="og:site_name" content="Zexho">
<meta property="og:description" content="芝兰生于幽谷,不因无人而不芳">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://p.ipic.vip/nkaktf.jpg">
<meta property="article:author" content="邹志浩">
<meta property="article:tag" content="技术,Java,博客">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://p.ipic.vip/nkaktf.jpg"><link rel="shortcut icon" href="https://p.ipic.vip/nkaktf.jpg"><link rel="canonical" href="https://zexho994.github.io/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":20,"languages":{"author":"作者: 邹志浩","link":"链接: ","source":"来源: Zexho","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Zexho',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-08-12 13:12:50'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{
  const $loadingBox = document.getElementById('loading-box')
  const $body = document.body
  const preloader = {
    endLoading: () => {
      $body.style.overflow = ''
      $loadingBox.classList.add('loaded')
    },
    initLoading: () => {
      $body.style.overflow = 'hidden'
      $loadingBox.classList.remove('loaded')
    }
  }

  preloader.initLoading()
  window.addEventListener('load',() => { preloader.endLoading() })

  if (true) {
    document.addEventListener('pjax:send', () => { preloader.initLoading() })
    document.addEventListener('pjax:complete', () => { preloader.endLoading() })
  }
})()</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://p.ipic.vip/nkaktf.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Zexho"><img class="site-icon" src="https://p.ipic.vip/nkaktf.jpg"/><span class="site-name">Zexho</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2023/03/16/%E6%9E%84%E5%BB%BA%20Antlr4%20AST%E7%9A%84%E4%B8%80%E7%82%B9%E5%BF%83%E5%BE%97/" title="构建 Antlr4 AST的一点心得">构建 Antlr4 AST的一点心得</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2023-03-16T03:20:21.000Z" title="发表于 2023-03-16 11:20:21">2023-03-16</time></span></div><div class="content">项目上需要用到实现自定义的一套 filter dsl, 来增强 es 搜索的能力. 采用了Antlr4作为语法解析工具, Antlr4 需要我们提供一套语法规则来帮助构建语法树, 那我们想要实现的效果大概有以下几个点:

语句之间的逻辑关系支持 “与” 和 “或”, 可以支持”&amp;&amp;”, “and” “||”, “or” 的格式
支持的条件判断有”eq” , “ne”, “gt”, “ge”, “lt”, ‘le”, “in”, “has”.
支持的数据的类型有两种, 字符串”String”和数字”Number”以及两者的数组类型.
同时需要支持 “( )” 的无限嵌套形式.

下面是个参考示例:
“ ‘sku.name’ has ‘香水’ and (‘sku.price’ le 120.5 || ‘shop.address’ in [‘湖南’, ‘广州’])”
意思很清晰就是: 商品名包含香水, 价格小于120.5或店铺地址在湖南或者广州.
这种语法其实算比较简单的了,规则不多也比较容易理解, 要说难点的话可能就是如何优雅地处理类似 ‘(xxx (xxx) (xxx)  ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/09/20/%E6%95%B4%E5%90%88%20Spring%20Cloud%20OpenFeign/" title="整合 Spring Cloud OpenFeign"><img class="post-bg" src="https://p.ipic.vip/7issjk.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="整合 Spring Cloud OpenFeign"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/09/20/%E6%95%B4%E5%90%88%20Spring%20Cloud%20OpenFeign/" title="整合 Spring Cloud OpenFeign">整合 Spring Cloud OpenFeign</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-20T03:20:21.000Z" title="发表于 2022-09-20 11:20:21">2022-09-20</time></span></div><div class="content">
Introduction to Spring Cloud OpenFeign

启动Consul可以使用本地的方式或者Docker的方式启动
本地启动1consul agent -dev


Server引入依赖pom文件内容如下
12345678910111213141516171819202122232425262728293031&lt;properties&gt;    &lt;java.version&gt;1.8&lt;/java.version&gt;    &lt;spring-cloud.version&gt;2021.0.4&lt;/spring-cloud.version&gt;&lt;/properties&gt;&lt;dependencies&gt;    &lt;dependency&gt;        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;    ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/09/19/%E5%88%9D%E6%8E%A2%20Spring%20Hateoas/" title="初探 Spring Hateoas"><img class="post-bg" src="https://p.ipic.vip/7issjk.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="初探 Spring Hateoas"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/09/19/%E5%88%9D%E6%8E%A2%20Spring%20Hateoas/" title="初探 Spring Hateoas">初探 Spring Hateoas</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-09-19T03:20:21.000Z" title="发表于 2022-09-19 11:20:21">2022-09-19</time></span></div><div class="content">
本文的内容参考于 An Intro to Spring HATEOAS

spring hateoas 是什么Hateoas 全名（Hypertext as the Engine of Application state）
Spring Hateoas 项目是一个为API而服务的库，我们可以通过 Hateoas 简单方便的创建 REST 风格的API。
一般来说，Hateoas 设计原则是通过Server API 返回的信息中包含一些信息，可以告诉 Client 下一步可以进行的操作，这样，理论上可以实现当 Server API 发生改变时，Client 不需要修改。
下面通过一个通过构建一个示例看下 Hateoas 看看是如何实现客户端和服务端解耦的。
示例Demo首先创建一个项目，这里使用了IDEA，可以看到右下角添加了 Spring HATEOAS 的依赖。

然后我们创建一个BO对象
12345678910public class Customer &#123;    private String customerId;    private String customerN ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/07/07/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Raft%20%E5%8D%8F%E8%AE%AE/" title="深入浅出 Raft 协议"><img class="post-bg" src="https://p.ipic.vip/910hj6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入浅出 Raft 协议"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/07/07/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Raft%20%E5%8D%8F%E8%AE%AE/" title="深入浅出 Raft 协议">深入浅出 Raft 协议</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-07-07T03:20:21.000Z" title="发表于 2022-07-07 11:20:21">2022-07-07</time></span></div><div class="content">在学习Raft之前，应该先了解Paxos，可以看 通俗的理解 Basic Paxos
背景Raft 属于分布式共识算法，先明白什么是分布式共识，用一句话说就是“保证多节点下数据一致”，Raft的一致性是强一致性（线性一致性），看下图
假设我们服务有3个节点，分别为S1,S2,S3, 节点可以存储数据,以日志的方式存储，下图中表示都存储了x&#x3D;1的日志。每个服务器都可以接口客户端的请求，然后修改数据，修改后会同步给其他节点。

这种方式有什么问题？ 可以分为两类，无法满足线性一致性，也无法满足最终一致性。
先看下线性一致性的异常情况，存在一种情况，如下：


t1时刻写完数据后，数据修改成功，客户端知道x&#x3D;2了.
在t3数据进行复制操作前的t2时刻，有客户端来读数据，发现x&#x3D;1.

假如这两个客户端是同一个人，知道x更新为2后，再次请求发现x又变成1，这十分奇怪
另一种情况，最终一致性:


t1时刻对s1写数据，s1追加x=2的日志.
t2时刻对s2写数据，s2追加x=3的日志.

然后s1,s2 开始同步数据，这会导致两者的数据不一致，s1的x=3，s2的 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/06/21/MIT6.824%20lab2%20Raft2B-%E6%97%A5%E5%BF%97%E5%90%8C%E6%AD%A5/" title="MIT6.824 lab2 Raft2B-日志同步"><img class="post-bg" src="https://p.ipic.vip/85ek56.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MIT6.824 lab2 Raft2B-日志同步"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/06/21/MIT6.824%20lab2%20Raft2B-%E6%97%A5%E5%BF%97%E5%90%8C%E6%AD%A5/" title="MIT6.824 lab2 Raft2B-日志同步">MIT6.824 lab2 Raft2B-日志同步</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-06-21T03:20:21.000Z" title="发表于 2022-06-21 11:20:21">2022-06-21</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/MIT/">MIT</a></span></div><div class="content">
课程地址：http://nil.csail.mit.edu/6.824/2021/labs/lab-raft.htmlRaft中文论文：https://yuerblog.cc/wp-content/uploads/raft-zh_cn.pdfRaft动画：http://www.kailing.pub/raft/index.html

目标在2A课程的基础上，服务器添加储log数据的要求，需要保证在各种故障环境下，保证log数据的强一致性。
主要任务围绕log需求，需要以下几个点进行改造：

选举投票阶段，需要检查candidate的日志的完整度，只能投票给日志不落后给自己的candidate
candidate当选为leader后，通过心跳让followers的log与自己保持完全一致（全量）
后续的心跳中，leader需要携带新的log数据，用于与followers进行log同步（增量）

设计要点投票约束Raft 通过⽐较两份⽇志中最后⼀条⽇志条⽬的索引值和任期号定义谁的⽇志⽐较新。如果两份 ⽇志最后的条⽬的任期号不同，那么任期号⼤的⽇志更加新。如果两份⽇志最后的条⽬任期号 相同 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/06/15/MIT6.824%20lab2%20Raft-Leader%20election/" title="MIT6.824 lab2 Raft-Leader election"><img class="post-bg" src="https://p.ipic.vip/85ek56.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MIT6.824 lab2 Raft-Leader election"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/06/15/MIT6.824%20lab2%20Raft-Leader%20election/" title="MIT6.824 lab2 Raft-Leader election">MIT6.824 lab2 Raft-Leader election</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-06-15T03:20:21.000Z" title="发表于 2022-06-15 11:20:21">2022-06-15</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/MIT/">MIT</a></span></div><div class="content">
本文假设你已经对课程进行了部分了解，所以不对课程的要求进行过多描述，重点在代码的分析和一些踩坑记录和理解。

课程链接： http://nil.csail.mit.edu/6.824/2020/labs/lab-raft.html
目标实现raft算法中的领导人选举部分



需要实现的部分
Make()

Raft{}

GetState()

RequestVote()

RequestVoteArgs{}

RequestVoteReply{}

AppendEntries()

AppendEntriesArgs {}

AppendEntriesReply {}


流程图理解了流程图，要实现代码就比较简单了

code这里直接展示代码，代码的逻辑配合流程图可以理解清楚。
Raft { }1234567891011121314151617181920212223242526272829303132333435363738394041const Leader int32 = 1const Follower int32 = 2const Candidate int32 = 3t ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/05/15/Mit%206.824%20lab1%20MapReduce/" title="Mit 6.824 lab1 MapReduce 设计"><img class="post-bg" src="https://p.ipic.vip/85ek56.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mit 6.824 lab1 MapReduce 设计"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/05/15/Mit%206.824%20lab1%20MapReduce/" title="Mit 6.824 lab1 MapReduce 设计">Mit 6.824 lab1 MapReduce 设计</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-05-15T03:20:21.000Z" title="发表于 2022-05-15 11:20:21">2022-05-15</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/MIT/">MIT</a></span></div><div class="content">课程概述这个课程的目的是让我们实现一个MapReduce，如果对MapReduce的基础概念不清楚，建议先看一下：

课程官网网页 : http://nil.csail.mit.edu/6.824/2020/labs/lab-mr.html

parper: https://pdos.csail.mit.edu/6.824/papers/mapreduce.pdf

https://spongecaptain.cool/post/paper/mapreduce/

https://www.bilibili.com/video/BV1Vb411m7go?spm_id_from=333.337.search-card.all.click



因 mit 课程要求，不能提供源码等信息，所以本文不提供具体的代码实现，而是说一说部分设计思路

课程中，我们是使用一台机器模拟出分布式的效果，通信使用RPC的方式，部署的方式是一个master + 多个worker。

master的主要任务就一个：分配task给worker

worker的主要任务有两个：1.向master请求task 2.判断 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2022/04/25/%E5%87%A0%E4%B8%AA%E6%9C%89%E8%B6%A3%E7%9A%84%E6%A6%82%E7%8E%87%E9%97%AE%E9%A2%98/" title="几个有趣的概率问题">几个有趣的概率问题</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-04-25T03:20:21.000Z" title="发表于 2022-04-25 11:20:21">2022-04-25</time></span></div><div class="content">
例子来源于《悖论-破解科学史上最复杂的9大谜团》第一章


消息的一块钱之谜

贝特箱子悖论 &amp; 小猫问题

蒙提霍尔悖论

生日悖论


贝特朗箱子悖论题目● 有三个箱子，每个箱子里各有两枚硬币
● 每个箱子分成两半，每一半都有一个球，可以单独打开看球的颜色
● 球的颜色有绿色和红色两种
● 箱子里球的搭配分为3种

问题现在随机选择一个箱子，然后随机打开一半，假设发现的是红球。

问：另一边也红球的概率是多少？
解答我相信第一反应都是1&#x2F;2，因为有红球的情况只有两种, 红红和红绿，所以红红的概率不就是1&#x2F;2了吗？
但是答案是2&#x2F;3。为什么？
下面给所有小球进行标记

看下各个可能的组合出现的概率

看完这个表格，我相信你已经明白了。
小猫问题题目假设你想购买两只猫，打电话给宠物店老板，老板说有两只猫
● 一只花猫，一只橘猫
然后问老板他们的性别，这时候可能有两种回答：

“检查了其中一只，是公猫”

“检查了花猫，是公猫”


问：这两种情况下，两只猫都是公猫的概率分别是多少？
解答绝大多数人第一反应我猜和我一样，两种情况的概率就是1&#x2 ...</div></div></div><div class="recent-post-item"><div class="post_cover left"><a href="/2022/04/09/%E6%9C%80%E9%80%9A%E4%BF%97%E7%9A%84%E7%90%86%E8%A7%A3%20Basic%20Paxos/" title="最通俗的理解 Basic Paxos"><img class="post-bg" src="https://p.ipic.vip/910hj6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="最通俗的理解 Basic Paxos"></a></div><div class="recent-post-info"><a class="article-title" href="/2022/04/09/%E6%9C%80%E9%80%9A%E4%BF%97%E7%9A%84%E7%90%86%E8%A7%A3%20Basic%20Paxos/" title="最通俗的理解 Basic Paxos">最通俗的理解 Basic Paxos</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-04-09T03:20:21.000Z" title="发表于 2022-04-09 11:20:21">2022-04-09</time></span><span class="article-meta tags"><span class="article-meta-separator">|</span><i class="fas fa-tag"></i><a class="article-meta__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/">分布式</a></span></div><div class="content">一个简单的分布式场景角色说明  

客户端Client，负责发起请求  
服务端Server，接收客户端的请求，并保存请求的数据

现在部署了3个Server，每个Server会保存客户端请求的信息，并以日志的方式进行存储。当客户端向Server_1发起请求后，Server_1会记录这个日志，并同步给Server_2，Server_3保持数据一致性，这个看起来没有什么问题。
但是加入是多个Client同时请求不同Server呢？看下会有什么问题

如何保证各Server的日志顺序保证一致？如每个服务器最后的log顺序都是log1,log2 或者 log2,log1
简单的数据复制方式肯定是不可以的，例如下面这种情况

最终Server_1日志顺序为log1 log2, Server_2日志顺序为log2 log1,Server_3日志顺序两种都有可能。
这就是分布式场景下经典的一致性问题，Paxos的目的就是为了解决这个问题，让所有Server的数据保持一致。
那么Paxos是如何解决这个问题的呢？也就是接下来要说明的问题。

在了解paxos之前，假如对2pc的概念不太清楚，建议先了 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/2022/03/25/%E5%BF%AB%E9%80%9F%E7%9C%8B%E6%B8%85lambda%E7%9A%84%E6%9C%AC%E8%B4%A8/" title="快速看清lambda的本质">快速看清lambda的本质</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">发表于</span><time datetime="2022-03-25T03:20:21.000Z" title="发表于 2022-03-25 11:20:21">2022-03-25</time></span></div><div class="content">在JDK8之后，Lambda表达式的功能为日常开发提供了很多便捷的操作，但是没接触过的人会对这种表达式有很大的疑惑，为什么要这样表示？我要怎么写出Lambda风格的代码？本文旨在快速理解lambda。
先看下lambda表达式是什么。在JDK8中，我们可以对接口添加一个注解@FunctionalInterface,我们看下JDK中Runnalble接口
123456@FunctionalInterfacepublic interface Runnable &#123;        void run();    &#125;

接口内有一个抽象方法run()，要注意一点，如果我们自己要实现一个lambda接口，那么接口内有且仅有一个抽象方法（default修饰的不算），为什么要这么限制？看完后文就知道了。
与Runnable常常一起出现的是Thread类，看下Thread中是如何使用Runnable的
123public Thread(Runnable target) &#123;    init(null, target, &quot;Thread-&quot; + nextThre ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/#content-inner">4</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://p.ipic.vip/nkaktf.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">邹志浩</div><div class="author-info__description">芝兰生于幽谷,不因无人而不芳</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">38</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/zexho994" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:zouzhihao994@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/03/16/%E6%9E%84%E5%BB%BA%20Antlr4%20AST%E7%9A%84%E4%B8%80%E7%82%B9%E5%BF%83%E5%BE%97/" title="构建 Antlr4 AST的一点心得">构建 Antlr4 AST的一点心得</a><time datetime="2023-03-16T03:20:21.000Z" title="发表于 2023-03-16 11:20:21">2023-03-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/20/%E6%95%B4%E5%90%88%20Spring%20Cloud%20OpenFeign/" title="整合 Spring Cloud OpenFeign"><img src="https://p.ipic.vip/7issjk.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="整合 Spring Cloud OpenFeign"/></a><div class="content"><a class="title" href="/2022/09/20/%E6%95%B4%E5%90%88%20Spring%20Cloud%20OpenFeign/" title="整合 Spring Cloud OpenFeign">整合 Spring Cloud OpenFeign</a><time datetime="2022-09-20T03:20:21.000Z" title="发表于 2022-09-20 11:20:21">2022-09-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/19/%E5%88%9D%E6%8E%A2%20Spring%20Hateoas/" title="初探 Spring Hateoas"><img src="https://p.ipic.vip/7issjk.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="初探 Spring Hateoas"/></a><div class="content"><a class="title" href="/2022/09/19/%E5%88%9D%E6%8E%A2%20Spring%20Hateoas/" title="初探 Spring Hateoas">初探 Spring Hateoas</a><time datetime="2022-09-19T03:20:21.000Z" title="发表于 2022-09-19 11:20:21">2022-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/07/07/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Raft%20%E5%8D%8F%E8%AE%AE/" title="深入浅出 Raft 协议"><img src="https://p.ipic.vip/910hj6.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="深入浅出 Raft 协议"/></a><div class="content"><a class="title" href="/2022/07/07/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%20Raft%20%E5%8D%8F%E8%AE%AE/" title="深入浅出 Raft 协议">深入浅出 Raft 协议</a><time datetime="2022-07-07T03:20:21.000Z" title="发表于 2022-07-07 11:20:21">2022-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/06/21/MIT6.824%20lab2%20Raft2B-%E6%97%A5%E5%BF%97%E5%90%8C%E6%AD%A5/" title="MIT6.824 lab2 Raft2B-日志同步"><img src="https://p.ipic.vip/85ek56.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MIT6.824 lab2 Raft2B-日志同步"/></a><div class="content"><a class="title" href="/2022/06/21/MIT6.824%20lab2%20Raft2B-%E6%97%A5%E5%BF%97%E5%90%8C%E6%AD%A5/" title="MIT6.824 lab2 Raft2B-日志同步">MIT6.824 lab2 Raft2B-日志同步</a><time datetime="2022-06-21T03:20:21.000Z" title="发表于 2022-06-21 11:20:21">2022-06-21</time></div></div></div></div><div class="card-widget" id="card-newest-comments"><div class="item-headline"><i class="fas fa-comment-dots"></i><span>最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>标签</span></div><div class="card-tag-cloud"><a href="/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 1.15em; color: rgb(56, 54, 123)">微信小程序</a><a href="/tags/Spring/" style="font-size: 1.15em; color: rgb(47, 99, 40)">Spring</a><a href="/tags/RocketMQ/" style="font-size: 1.45em; color: rgb(107, 116, 24)">RocketMQ</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 1.3em; color: rgb(177, 177, 119)">分布式</a><a href="/tags/MIT/" style="font-size: 1.3em; color: rgb(94, 49, 46)">MIT</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">三月 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">九月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/07/"><span class="card-archive-list-date">七月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/06/"><span class="card-archive-list-date">六月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/05/"><span class="card-archive-list-date">五月 2022</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/04/"><span class="card-archive-list-date">四月 2022</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/03/"><span class="card-archive-list-date">三月 2022</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/02/"><span class="card-archive-list-date">二月 2022</span><span class="card-archive-list-count">1</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>网站资讯</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">文章数目 :</div><div class="item-count">38</div></div><div class="webinfo-item"><div class="item-name">已运行时间 :</div><div class="item-count" id="runtimeshow" data-publishDate="2019-02-09T00:06:30.000Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总字数 :</div><div class="item-count">47.6k</div></div><div class="webinfo-item"><div class="item-name">本站访客数 :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">本站总访问量 :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">最后更新时间 :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-08-12T05:12:50.445Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2023 By 邹志浩</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const findTrueUrl = (array) => {
    Promise.all(array.map(item =>
      fetch(item.url).then(resp => resp.json()).then(data => {
        const urlArray = data.body.match(/(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?/ig)
        if (data.user.login === 'utterances-bot') {
          return urlArray.pop()
        } else {
          return urlArray.shift()
        }
      })
    )).then(res => {
        array = array.map((i,index)=> {
          return {
            ...i,
            url: res[index]
          }
        })

        saveToLocal.set('github-newest-comments', JSON.stringify(array), 10/(60*24))
        generateHtml(array)
    });
  }

  const getComment = () => {
    fetch('https://api.github.com/repos/zexho994/zexho994.github.io/issues/comments?sort=updated&direction=desc&per_page=5&page=1',{
      "headers": {
        Accept: 'application/vnd.github.v3.html+json'
      }
    })
      .then(response => response.json())
      .then(data => {
        const githubArray = data.map(item => {
          return {
            'avatar': item.user.avatar_url,
            'content': changeContent(item.body_html),
            'nick': item.user.login,
            'url': item.issue_url,
            'date': item.updated_at,
            'githubUrl': item.html_url
          }
        })
        findTrueUrl(githubArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('github-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>